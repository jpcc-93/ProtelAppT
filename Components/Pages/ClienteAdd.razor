
@page "/cliente-add"
@inherits ProtelAppT.Service.CrudComponentBase<Cliente>
@inject IGenericRepository Repo
@inject ISnackbar Snackbar
@using ProtelAppT.Data
@using ProtelAppT.Repositories

<MudPaper Class="pa-6 mt-10 mx-auto rounded elevation-8" MaxWidth="600px"
Style="border: 1px solid #ccc; box-shadow: 0 2px 12px rgba(0,0,0,0.1);">
    <MudText Typo="Typo.h5" Class="mb-4">Registrar Nuevo Cliente</MudText>


    <EditForm Model="@Entity" OnValidSubmit="GuardarCliente">
        <ValidationSummary />
        <DataAnnotationsValidator />
        <MudGrid>
            <MudItem xs="12">
                <MudTextField Label="Nombre" @bind-Value="Entity.Nombre" Required="true" />
            </MudItem>

            <MudItem xs="12">
                <MudTextField Label="Dirección" @bind-Value="Entity.Direccion" Required="true" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudTextField Label="Teléfono" @bind-Value="Entity.Telefono" Required="true" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudTextField Label="Email" @bind-Value="Entity.Email" Required="true" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudSelect T="int" Label="Estado del Cliente" @bind-Value="Entity.IdEstadoCliente" Required="true">
                    @foreach (var estado in estadosCliente)
                    {
                        <MudSelectItem Value="@estado.IdEstadoCliente">@estado.Nombre</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>

            <MudItem xs="12">
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Guardar</MudButton>
            </MudItem>
        </MudGrid>
    </EditForm>
</MudPaper>


@code {

    private List<EstadoCliente> estadosCliente = new();

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        estadosCliente = await Repo.GetAllAsync<EstadoCliente>();
    }


    private async Task GuardarCliente()
    {
        Entity.FechaCreacion = DateTime.Now;
        Entity.FechaActualizacion = DateTime.Now;
        await Save(); 
        Snackbar.Add("Cliente agregado.", Severity.Success);
        
    }
}
